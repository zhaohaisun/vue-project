import{r as i,a as Z,g as ee,M as te,c as W,o as $,d as e,w as t,e as r,E as se,b as a,C as m,i as S,z as ae,O as oe,s as le,f as C,l as ne,P as re,k as ie}from"./index-Blt1EybH.js";import{s as U}from"./index-8GxjogwN.js";import*as V from"https://cdn.jsdelivr.net/npm/echarts@5/+esm";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";const de={class:"system-info"},ue={class:"card-header"},pe={class:"card-header"},fe={class:"chart-container"},_e={class:"stat-number"},he={class:"card-header"},me={class:"chart-container"},ve={class:"stat-number"},ye={class:"card-header"},we={class:"chart-container"},ge={class:"stat-number"},be={class:"card-header"},xe={key:0,class:"db-path"},Se={__name:"SystemInfo",setup(Ce){const M=i(0),T=i(0),B=i(0),I=i(!1);let L=null;const P=i(null),G=i(null),F=i(null);let c=null,d=null,u=null;const E=i(localStorage.getItem("currentDatabase")||"test"),K=i([]),R=i(""),g=Z({total:0,used:0,free:0,heap:0,nonHeap:0}),j=i([]),z=async()=>{var o,s;try{const l=(await U.getSystemResources()).data||{},b=N(l.usedMemory||"0 MB"),p=N(l.totalMemory||"0 MB"),_=N(l.freeMemory||"0 MB"),h=p>0?b/p*100:0;M.value=parseFloat(((o=l.processCpuLoad)==null?void 0:o.replace("%",""))||((s=l.systemCpuLoad)==null?void 0:s.replace("%",""))||0),T.value=h.toFixed(2),g.total=p,g.used=b,g.free=_;const w=(await U.getSystemThreads()).data||{};B.value=w.qtpThreadCount||0;const D=[];if(w.qtpThreadStates&&Object.entries(w.qtpThreadStates).forEach(([f,v])=>{D.push({name:`${f} 线程`,state:f,count:v})}),j.value=D,E.value)try{const v=(await U.getDatabaseSpace(E.value)).data||{};v.space_statistics&&(K.value=Object.entries(v.space_statistics).map(([k,x])=>({name:H(k),size:x}))),v.db_path&&(R.value=v.db_path)}catch(f){console.error("获取数据库空间信息失败:",f)}J()}catch(n){console.error("获取系统信息失败:",n),se.error("获取系统信息失败")}},N=o=>{if(!o)return 0;const s=/(\d+\.?\d*)\s*([KMGT]?B)/i,n=o.match(s);if(!n)return 0;const l=parseFloat(n[1]),b=n[2].toUpperCase(),p={B:1,KB:1024,MB:1024*1024,GB:1024*1024*1024,TB:1024*1024*1024*1024};return l*(p[b]||1)},H=o=>o.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),J=()=>{if(c&&c.setOption({series:[{data:[{value:M.value,name:"CPU使用率"}]}]}),d&&d.setOption({series:[{data:[{value:T.value,name:"内存使用率"}]}]}),u){const o=new Date;y.push([o.getTime(),B.value]);const s=o.getTime()-10*60*1e3;for(;y.length>0&&y[0][0]<s;)y.shift();u.setOption({series:[{data:y}]})}},y=[],Q=()=>{c=V.init(P.value),c.setOption({series:[{type:"gauge",startAngle:90,endAngle:-270,pointer:{show:!1},progress:{show:!0,overlap:!1,roundCap:!0,clip:!1,itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#1a237e"},{offset:1,color:"#5c6bc0"}]}}},axisLine:{lineStyle:{width:15}},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},data:[{value:M.value,name:"CPU使用率",title:{offsetCenter:["0%","0%"]},detail:{valueAnimation:!0,offsetCenter:["0%","0%"]}}]}]}),d=V.init(G.value),d.setOption({series:[{type:"gauge",startAngle:90,endAngle:-270,pointer:{show:!1},progress:{show:!0,overlap:!1,roundCap:!0,clip:!1,itemStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"#00695c"},{offset:1,color:"#4db6ac"}]}}},axisLine:{lineStyle:{width:15}},splitLine:{show:!1},axisTick:{show:!1},axisLabel:{show:!1},data:[{value:T.value,name:"内存使用率",title:{offsetCenter:["0%","0%"]},detail:{valueAnimation:!0,offsetCenter:["0%","0%"]}}]}]}),u=V.init(F.value);const o=new Date;y.push([o.getTime(),B.value]),u.setOption({grid:{left:"5%",right:"5%",top:"5%",bottom:"5%",containLabel:!0},xAxis:{type:"time",splitLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!1}},yAxis:{type:"value",splitLine:{show:!1},axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!1}},series:[{data:y,type:"line",smooth:!0,symbol:"none",areaStyle:{color:{type:"linear",x:0,y:0,x2:0,y2:1,colorStops:[{offset:0,color:"rgba(128, 0, 128, 0.5)"},{offset:1,color:"rgba(128, 0, 128, 0.1)"}]}},lineStyle:{color:"purple"}}]}),window.addEventListener("resize",q)},q=()=>{c==null||c.resize(),d==null||d.resize(),u==null||u.resize()},X=o=>{o?L=setInterval(z,5e3):clearInterval(L)},O=o=>{if(!o)return"0 B";const s=["B","KB","MB","GB","TB"];let n=0,l=o;for(;l>=1024&&n<s.length-1;)l/=1024,n++;return`${l.toFixed(2)} ${s[n]}`},Y=o=>({RUNNABLE:"success",BLOCKED:"danger",WAITING:"warning",TIMED_WAITING:"info",NEW:"primary",TERMINATED:"danger"})[o]||"";return ee(()=>{z(),setTimeout(()=>{Q()},100)}),te(()=>{L&&clearInterval(L),window.removeEventListener("resize",q),c==null||c.dispose(),d==null||d.dispose(),u==null||u.dispose()}),(o,s)=>{const n=r("el-button"),l=r("el-tooltip"),b=r("el-switch"),p=r("el-icon"),_=r("el-card"),h=r("el-col"),A=r("el-row"),w=r("el-descriptions-item"),D=r("el-descriptions"),f=r("el-table-column"),v=r("el-tag"),k=r("el-table");return $(),W("div",de,[e(A,{gutter:20},{default:t(()=>[e(h,{span:24},{default:t(()=>[e(_,{class:"system-card"},{header:t(()=>[a("div",ue,[s[1]||(s[1]=a("span",null,"系统资源监控",-1)),a("div",null,[e(l,{content:"刷新",placement:"top"},{default:t(()=>[e(n,{icon:S(ie),circle:"",onClick:z},null,8,["icon"])]),_:1}),e(l,{content:"自动刷新",placement:"top"},{default:t(()=>[e(b,{modelValue:I.value,"onUpdate:modelValue":s[0]||(s[0]=x=>I.value=x),"active-text":"自动刷新",onChange:X},null,8,["modelValue"])]),_:1})])])]),default:t(()=>[e(A,{gutter:20,class:"stat-cards"},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(_,{shadow:"hover"},{header:t(()=>[a("div",pe,[e(p,null,{default:t(()=>[e(S(ae))]),_:1}),s[2]||(s[2]=a("span",null,"CPU使用率",-1))])]),default:t(()=>[a("div",fe,[a("div",{ref_key:"cpuChart",ref:P,class:"chart"},null,512),a("div",_e,m(M.value)+"%",1)])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(_,{shadow:"hover"},{header:t(()=>[a("div",he,[e(p,null,{default:t(()=>[e(S(oe))]),_:1}),s[3]||(s[3]=a("span",null,"内存使用率",-1))])]),default:t(()=>[a("div",me,[a("div",{ref_key:"memoryChart",ref:G,class:"chart"},null,512),a("div",ve,m(T.value)+"%",1)])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(_,{shadow:"hover"},{header:t(()=>[a("div",ye,[e(p,null,{default:t(()=>[e(S(le))]),_:1}),s[4]||(s[4]=a("span",null,"线程数",-1))])]),default:t(()=>[a("div",we,[a("div",{ref_key:"threadChart",ref:F,class:"chart"},null,512),a("div",ge,m(B.value),1)])]),_:1})]),_:1})]),_:1}),e(A,{gutter:20,class:"details-row"},{default:t(()=>[e(h,{span:8},{default:t(()=>[e(_,{shadow:"hover",class:"detail-card"},{header:t(()=>s[5]||(s[5]=[a("div",{class:"card-header"},[a("span",null,"内存详情")],-1)])),default:t(()=>[e(D,{border:"",column:1},{default:t(()=>[e(w,{label:"总内存"},{default:t(()=>[C(m(O(g.total)),1)]),_:1}),e(w,{label:"已使用"},{default:t(()=>[C(m(O(g.used)),1)]),_:1}),e(w,{label:"空闲内存"},{default:t(()=>[C(m(O(g.free)),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(_,{shadow:"hover",class:"detail-card"},{header:t(()=>s[6]||(s[6]=[a("div",{class:"card-header"},[a("span",null,"线程状态")],-1)])),default:t(()=>[e(k,{data:j.value,style:{width:"100%"},height:"216px","header-cell-style":{background:"#f5f7fa"}},{default:t(()=>[e(f,{prop:"name",label:"线程状态"}),e(f,{prop:"count",label:"数量"},{default:t(x=>[e(v,{type:Y(x.row.state)},{default:t(()=>[C(m(x.row.count),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),e(h,{span:8},{default:t(()=>[e(_,{shadow:"hover",class:"detail-card"},{header:t(()=>[a("div",be,[e(p,null,{default:t(()=>[e(S(re))]),_:1}),a("span",null,"数据库空间 ("+m(E.value)+")",1)])]),default:t(()=>[R.value?($(),W("p",xe,[s[7]||(s[7]=a("span",{class:"label"},"路径:",-1)),C(" "+m(R.value),1)])):ne("",!0),e(k,{data:K.value,style:{width:"100%"},height:"180px","header-cell-style":{background:"#f5f7fa"}},{default:t(()=>[e(f,{prop:"name",label:"数据类型"}),e(f,{prop:"size",label:"大小"})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}},Le=ce(Se,[["__scopeId","data-v-6a9239da"]]);export{Le as default};
