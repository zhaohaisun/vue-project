import{n as E,r as O}from"./index-BE28LO_H.js";import{P as T}from"./papaparse.min-CjDpJk8J.js";import{_ as R}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as _,c as b,o as $,d as l,w as t,e as m,l as V,f as h,b as i,C as x,E as y}from"./index-DIFXjpxf.js";let p={};const k="graph_node_id_map",L=()=>{try{localStorage.setItem(k,JSON.stringify(p)),console.log("节点ID映射已保存到本地存储")}catch(s){console.error("保存节点ID映射失败",s)}},P=()=>{try{const s=localStorage.getItem(k);if(s)return p=JSON.parse(s),console.log("从本地存储加载了节点ID映射"),!0}catch(s){console.error("加载节点ID映射失败",s)}return!1},A=async(s,n=!0)=>{try{n?p={}:Object.keys(p).length===0&&P();const u=await(await fetch(s)).text(),{data:r}=T.parse(u,{header:!0});console.log(`开始导入节点，总计 ${r.length} 条数据`);let e=0;for(const o of r){if(!o.Id||o.Id==="")continue;const f={Id:o.Id,latitude:parseFloat(o.latitude),longitude:parseFloat(o.longitude)};try{await E.createNode(f),p[o.Id]=e,e++,e%1e3===0&&console.log(`已创建 ${e} 个节点`)}catch(g){console.error(`创建节点失败: ${o.Id}`,g)}}return L(),console.log(`导入完成! 成功创建 ${e} 个节点`),e}catch(d){throw console.error("导入节点数据失败",d),d}},B=async s=>{try{if(Object.keys(p).length===0&&!P())return console.error("节点ID映射为空，请先导入节点数据"),0;const d=await(await fetch(s)).text(),{data:u}=T.parse(d,{header:!0});console.log(`开始导入边，总计 ${u.length} 条数据`);let r=0;for(const e of u){if(!e.Source||!e.Target)continue;const o=p[e.Source],f=p[e.Target],g={Id:e.Id,Label:e.Label||"",highwayType:e.highwayType||""};try{if(o===void 0||f===void 0){console.warn(`创建边 ${e.Id} 时发现节点映射缺失:`,o===void 0?`源节点 ${e.Source} 不在映射中`:"",f===void 0?`目标节点 ${e.Target} 不在映射中`:"");continue}await O.createRelationship(o,f,e.Type||"Directed",g),r++,r%1e3===0&&console.log(`已创建 ${r} 条边`)}catch(c){console.error(`创建边失败: ${e.Source} -> ${e.Target}`,c)}}return console.log(`导入完成! 成功创建 ${r} 条边`),r}catch(n){throw console.error("导入边数据失败",n),n}},F={class:"data-import-container"},j={key:0,class:"result-box"},J={key:0,class:"result-box"},U={__name:"DataImport",setup(s){const n=_("/data/node-with-latitude-longitude.csv"),d=_("/data/edge-with-road-label.csv"),u=_(!1),r=_(!1),e=_(""),o=_(""),f=async()=>{try{u.value=!0,e.value="";const c=await A(n.value);e.value=`成功导入 ${c} 个节点`,y.success(e.value)}catch(c){e.value=`导入失败: ${c.message}`,y.error(e.value)}finally{u.value=!1}},g=async()=>{try{r.value=!0,o.value="";const c=await B(d.value);o.value=`成功导入 ${c} 条边`,y.success(o.value)}catch(c){o.value=`导入失败: ${c.message}`,y.error(o.value)}finally{r.value=!1}};return(c,a)=>{const N=m("el-input"),v=m("el-form-item"),D=m("el-button"),S=m("el-form"),I=m("el-card"),C=m("el-col"),M=m("el-row");return $(),b("div",F,[l(I,{class:"import-card"},{header:t(()=>a[2]||(a[2]=[i("div",{class:"card-header"},[i("h2",null,"数据导入")],-1)])),default:t(()=>[l(M,{gutter:20},{default:t(()=>[l(C,{span:12},{default:t(()=>[l(I,{class:"inner-card"},{header:t(()=>a[3]||(a[3]=[i("div",{class:"card-header"},[i("h3",null,"节点导入")],-1)])),default:t(()=>[l(S,null,{default:t(()=>[l(v,null,{default:t(()=>[l(N,{modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=w=>n.value=w),placeholder:"节点CSV文件路径",clearable:""},{prepend:t(()=>a[4]||(a[4]=[h("文件路径")])),_:1},8,["modelValue"])]),_:1}),l(v,null,{default:t(()=>[l(D,{type:"primary",onClick:f,loading:u.value,disabled:!n.value},{default:t(()=>a[5]||(a[5]=[h(" 导入节点数据 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1}),e.value?($(),b("div",j,[i("p",null,"导入结果: "+x(e.value),1)])):V("",!0)]),_:1})]),_:1}),l(C,{span:12},{default:t(()=>[l(I,{class:"inner-card"},{header:t(()=>a[6]||(a[6]=[i("div",{class:"card-header"},[i("h3",null,"边导入")],-1)])),default:t(()=>[l(S,null,{default:t(()=>[l(v,null,{default:t(()=>[l(N,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=w=>d.value=w),placeholder:"边CSV文件路径",clearable:""},{prepend:t(()=>a[7]||(a[7]=[h("文件路径")])),_:1},8,["modelValue"])]),_:1}),l(v,null,{default:t(()=>[l(D,{type:"primary",onClick:g,loading:r.value,disabled:!d.value},{default:t(()=>a[8]||(a[8]=[h(" 导入边数据 ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1}),o.value?($(),b("div",J,[i("p",null,"导入结果: "+x(o.value),1)])):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1})])}}},G=R(U,[["__scopeId","data-v-83f9c229"]]);export{G as default};
