import{_ as Y}from"./graph-logo-Dt0DBtTi.js";import{r as f,n as E,q as Z,a as ee,g as oe,u as ae,c as I,o as S,d as o,w as a,e as r,b as n,i,t as se,v as te,x as re,y as le,z as ne,A as de,B as ue,f as d,C as y,l as ie,D as me,E as c}from"./index-B3ZjBOUV.js";import{u as F}from"./index-BE28LO_H.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const fe={class:"dashboard"},_e={class:"header-left"},ce={class:"header-right"},we={key:0,class:"db-info"},ge={class:"user-dropdown"},be={class:"dialog-footer"},ve={__name:"Dashboard",setup(Pe){const x=Z(),w=ae(),g=f("用户"),V=f(localStorage.getItem("currentDatabase")||""),R=E(()=>x.path),U=E(()=>{const s=x.path;return s.includes("graph")?"图谱视图":s.includes("nodes")?"节点管理":s.includes("relationships")?"关系管理":s.includes("database")?"数据库管理":s.includes("system")?"系统信息":s.includes("map")?"地图可视化":s.includes("import")?"数据导入":"首页"}),p=f(!1),b=f(!1),_=f(null),q=(s,e,t)=>{e===""?t(new Error("请输入新密码")):(l.confirmPassword!==""&&_.value.validateField("confirmPassword"),t())},B=(s,e,t)=>{e===""?t(new Error("请再次输入新密码")):e!==l.newPassword?t(new Error("两次输入密码不一致")):t()},l=ee({currentPassword:"",newPassword:"",confirmPassword:""}),N={currentPassword:[{required:!0,message:"请输入当前密码",trigger:"blur"}],newPassword:[{required:!0,validator:q,trigger:"blur"},{min:6,message:"密码长度至少为 6 个字符",trigger:"blur"}],confirmPassword:[{required:!0,validator:B,trigger:"blur"}]},L=s=>{s==="logout"?T():s==="changePassword"?p.value=!0:s==="switchDatabase"&&M()},M=()=>{localStorage.removeItem("currentDatabase"),w.push("/select-database")},T=async()=>{try{await F.logout(),localStorage.removeItem("token"),localStorage.removeItem("username"),c.success("已退出登录"),w.push("/login")}catch(s){console.error("登出失败:",s),c.error("登出失败，请稍后再试")}},z=async()=>{var s,e;if(_.value)try{await _.value.validate(),b.value=!0;const t={currentPassword:l.currentPassword,newPassword:l.newPassword};await F.changePassword(g.value,t),c.success("密码修改成功"),p.value=!1,l.currentPassword="",l.newPassword="",l.confirmPassword=""}catch(t){console.error("密码修改失败:",t),c.error(((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.message)||"密码修改失败，请稍后再试")}finally{b.value=!1}};return oe(async()=>{if(!localStorage.getItem("token")){w.push("/login");return}const e=localStorage.getItem("username");e&&(g.value=e)}),(s,e)=>{const t=r("el-icon"),m=r("el-menu-item"),A=r("el-menu"),G=r("el-aside"),D=r("el-breadcrumb-item"),$=r("el-breadcrumb"),j=r("el-tag"),v=r("el-dropdown-item"),H=r("el-dropdown-menu"),J=r("el-dropdown"),K=r("el-header"),O=r("router-view"),Q=r("el-main"),k=r("el-container"),P=r("el-input"),h=r("el-form-item"),W=r("el-form"),C=r("el-button"),X=r("el-dialog");return S(),I("div",fe,[o(k,{class:"dashboard-container"},{default:a(()=>[o(G,{width:"240px",class:"dashboard-aside"},{default:a(()=>[e[12]||(e[12]=n("div",{class:"logo-container"},[n("img",{src:Y,alt:"TGraph Logo",class:"logo"}),n("h2",null,"TGraph")],-1)),o(A,{router:!0,"default-active":R.value,class:"dashboard-menu","background-color":"#001529","text-color":"#fff","active-text-color":"#409EFF"},{default:a(()=>[o(m,{index:"/dashboard/graph"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(se))]),_:1}),e[5]||(e[5]=n("span",null,"图谱视图",-1))]),_:1}),o(m,{index:"/dashboard/nodes"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(te))]),_:1}),e[6]||(e[6]=n("span",null,"节点管理",-1))]),_:1}),o(m,{index:"/dashboard/relationships"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(re))]),_:1}),e[7]||(e[7]=n("span",null,"关系管理",-1))]),_:1}),o(m,{index:"/dashboard/database"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(le))]),_:1}),e[8]||(e[8]=n("span",null,"数据库管理",-1))]),_:1}),o(m,{index:"/dashboard/system"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(ne))]),_:1}),e[9]||(e[9]=n("span",null,"系统信息",-1))]),_:1}),o(m,{index:"/dashboard/map"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(de))]),_:1}),e[10]||(e[10]=n("span",null,"地图可视化",-1))]),_:1}),o(m,{index:"/dashboard/import"},{default:a(()=>[o(t,null,{default:a(()=>[o(i(ue))]),_:1}),e[11]||(e[11]=n("span",null,"数据导入",-1))]),_:1})]),_:1},8,["default-active"])]),_:1}),o(k,{class:"main-container"},{default:a(()=>[o(K,{class:"dashboard-header"},{default:a(()=>[n("div",_e,[o($,{separator:"/"},{default:a(()=>[o(D,{to:{path:"/dashboard"}},{default:a(()=>e[13]||(e[13]=[d("首页")])),_:1}),o(D,null,{default:a(()=>[d(y(U.value),1)]),_:1})]),_:1})]),n("div",ce,[V.value?(S(),I("div",we,[o(j,{size:"small",type:"success"},{default:a(()=>[d("当前数据库: "+y(V.value),1)]),_:1})])):ie("",!0),o(J,{onCommand:L},{dropdown:a(()=>[o(H,null,{default:a(()=>[o(v,{command:"changePassword"},{default:a(()=>e[14]||(e[14]=[d("修改密码")])),_:1}),o(v,{command:"switchDatabase"},{default:a(()=>e[15]||(e[15]=[d("切换数据库")])),_:1}),o(v,{divided:"",command:"logout"},{default:a(()=>e[16]||(e[16]=[d("退出登录")])),_:1})]),_:1})]),default:a(()=>[n("span",ge,[d(y(g.value)+" ",1),o(t,null,{default:a(()=>[o(i(me))]),_:1})])]),_:1})])]),_:1}),o(Q,{class:"dashboard-main"},{default:a(()=>[o(O)]),_:1})]),_:1})]),_:1}),o(X,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=u=>p.value=u),title:"修改密码",width:"400px"},{footer:a(()=>[n("span",be,[o(C,{onClick:e[3]||(e[3]=u=>p.value=!1)},{default:a(()=>e[17]||(e[17]=[d("取消")])),_:1}),o(C,{type:"primary",onClick:z,loading:b.value},{default:a(()=>e[18]||(e[18]=[d(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>[o(W,{model:l,rules:N,ref_key:"passwordFormRef",ref:_,"label-width":"100px"},{default:a(()=>[o(h,{label:"当前密码",prop:"currentPassword"},{default:a(()=>[o(P,{modelValue:l.currentPassword,"onUpdate:modelValue":e[0]||(e[0]=u=>l.currentPassword=u),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),o(h,{label:"新密码",prop:"newPassword"},{default:a(()=>[o(P,{modelValue:l.newPassword,"onUpdate:modelValue":e[1]||(e[1]=u=>l.newPassword=u),type:"password","show-password":""},null,8,["modelValue"])]),_:1}),o(h,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[o(P,{modelValue:l.confirmPassword,"onUpdate:modelValue":e[2]||(e[2]=u=>l.confirmPassword=u),type:"password","show-password":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},De=pe(ve,[["__scopeId","data-v-532aab32"]]);export{De as default};
