import{r as i,a as q,M as Q,g as W,c as L,o as D,d as a,w as s,e as r,E as d,b as n,h as X,l as Y,f as u,C as v,i as x,k as E}from"./index-Blt1EybH.js";import{d as b,u as Z}from"./index-8GxjogwN.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const te={class:"database-management"},ae={class:"card-header"},se={class:"db-status-container"},oe={class:"status-header"},ne={class:"space-details"},le={class:"total-size"},re={class:"db-actions"},ce={class:"http-logs-container"},ie={class:"logs-header"},de={key:0,class:"logs-loading"},ue={key:1,class:"logs-content"},pe={class:"logs-pre"},_e={__name:"DatabaseManagement",setup(me){const w=i(!1),B=i(!1),z=i(!1),h=i(localStorage.getItem("currentDatabase")||"test"),m=i([]),o=q({name:h.value,status:null,path:"",size:0}),C=()=>{const t=localStorage.getItem("currentDatabase");t!==h.value&&(h.value=t||"test",o.name=h.value,g())};window.addEventListener("storage",t=>{t.key==="currentDatabase"&&C()});const N=setInterval(C,2e3);Q(()=>{clearInterval(N),window.removeEventListener("storage",C)});const g=async()=>{var t,e,l,c;try{const p=await b.getDatabaseStatus(o.name);o.status=((t=p.data)==null?void 0:t.status)||"stopped";const f=await b.getDatabasePath(o.name);o.path=((e=f.data)==null?void 0:e.path)||"";const _=await b.getDatabaseSpace(o.name);o.size=((l=_.data)==null?void 0:l.totalSize)||0,(c=_.data)!=null&&c.space_statistics?m.value=Object.entries(_.data.space_statistics).map(([k,S])=>({name:H(k),size:S})):m.value=[]}catch(p){console.error("获取数据库信息失败:",p),d.error("获取数据库信息失败")}},H=t=>t.split("_").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" "),P=()=>{if(!m.value||m.value.length===0)return"0 B";let t=0;return m.value.forEach(e=>{const l=e.size;if(typeof l=="string"){const c=l.match(/^([\d.]+)\s*([KMGT]?B)$/i);if(c){const p=parseFloat(c[1]),f=c[2].toUpperCase(),_={B:1,KB:1024,MB:1024*1024,GB:1024*1024*1024,TB:1024*1024*1024*1024};t+=p*(_[f]||1)}}}),A(t)},U=async()=>{w.value=!0;try{await b.startDatabase(o.name),d.success("数据库启动成功"),g()}catch(t){console.error("启动数据库失败:",t),d.error("启动数据库失败")}finally{w.value=!1}},V=async()=>{B.value=!0;try{await b.stopDatabase(),d.success("数据库已关闭"),g()}catch(t){console.error("关闭数据库失败:",t),d.error("关闭数据库失败")}finally{B.value=!1}},j=async()=>{z.value=!0;try{await b.backupDatabase(o.name),d.success("数据库备份成功")}catch(t){console.error("备份数据库失败:",t),d.error("备份数据库失败")}finally{z.value=!1}},A=t=>{if(!t)return"0 B";const e=["B","KB","MB","GB","TB"];let l=0,c=t;for(;c>=1024&&l<e.length-1;)c/=1024,l++;return`${c.toFixed(2)} ${e[l]}`},F=i([]),T=i(""),y=i(!1),M=async()=>{y.value=!0;try{const t=await Z.getUserLogs();F.value=t.data||[],T.value=JSON.stringify(t.data,null,2)}catch(t){console.error("获取HTTP日志失败:",t),d.error("获取HTTP日志失败"),T.value="获取日志失败: "+(t.message||"未知错误")}finally{y.value=!1}};return W(()=>{g(),M()}),(t,e)=>{const l=r("el-button"),c=r("el-tooltip"),p=r("el-tag"),f=r("el-descriptions-item"),_=r("el-descriptions"),k=r("el-table-column"),S=r("el-table"),I=r("el-tab-pane"),G=r("el-icon"),K=r("el-skeleton"),R=r("el-tabs"),$=r("el-card"),O=r("el-col"),J=r("el-row");return D(),L("div",te,[a(J,{gutter:20},{default:s(()=>[a(O,{span:24},{default:s(()=>[a($,{class:"db-card"},{header:s(()=>[n("div",ae,[e[0]||(e[0]=n("span",null,"数据库管理",-1)),n("div",null,[a(c,{content:"刷新",placement:"top"},{default:s(()=>[a(l,{icon:x(E),circle:"",onClick:g},null,8,["icon"])]),_:1})])])]),default:s(()=>[a(R,{type:"border-card"},{default:s(()=>[a(I,{label:"数据库状态"},{default:s(()=>[n("div",se,[n("div",oe,[e[1]||(e[1]=n("h3",null,"数据库状态",-1)),o.status?(D(),X(p,{key:0,type:o.status==="running"?"success":"danger"},{default:s(()=>[u(v(o.status==="running"?"运行中":"已停止"),1)]),_:1},8,["type"])):Y("",!0)]),a(_,{border:"",column:1,class:"db-info"},{default:s(()=>[a(f,{label:"数据库名称"},{default:s(()=>[u(v(o.name||"neo4j-hello-db"),1)]),_:1}),a(f,{label:"数据文件位置"},{default:s(()=>[u(v(o.path||"获取中..."),1)]),_:1})]),_:1}),n("div",ne,[e[3]||(e[3]=n("h4",null,"数据库文件大小详情",-1)),a(S,{data:m.value,style:{width:"100%"},size:"small",border:"",stripe:"","header-cell-style":{backgroundColor:"#f5f7fa"}},{default:s(()=>[a(k,{prop:"name",label:"数据类型",width:"180"}),a(k,{prop:"size",label:"大小"})]),_:1},8,["data"]),n("div",le,[n("span",null,[e[2]||(e[2]=u("总大小: ")),n("strong",null,v(P()),1)])])]),n("div",re,[a(l,{type:"primary",disabled:o.status==="running",onClick:U,loading:w.value},{default:s(()=>e[4]||(e[4]=[u(" 启动数据库 ")])),_:1},8,["disabled","loading"]),a(l,{type:"danger",disabled:o.status!=="running",onClick:V,loading:B.value},{default:s(()=>e[5]||(e[5]=[u(" 关闭数据库 ")])),_:1},8,["disabled","loading"]),a(l,{type:"warning",disabled:o.status==="running",onClick:j,loading:z.value},{default:s(()=>e[6]||(e[6]=[u(" 备份数据库 ")])),_:1},8,["disabled","loading"])])])]),_:1}),a(I,{label:"HTTP日志"},{default:s(()=>[n("div",ce,[n("div",ie,[e[8]||(e[8]=n("h3",null,"系统HTTP请求日志",-1)),a(l,{type:"primary",size:"small",onClick:M,loading:y.value},{default:s(()=>[a(G,null,{default:s(()=>[a(x(E))]),_:1}),e[7]||(e[7]=u(" 刷新日志 "))]),_:1},8,["loading"])]),y.value?(D(),L("div",de,[a(K,{rows:10,animated:""})])):(D(),L("div",ue,[n("pre",pe,v(T.value),1)]))])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])}}},ve=ee(_e,[["__scopeId","data-v-9c14b56d"]]);export{ve as default};
