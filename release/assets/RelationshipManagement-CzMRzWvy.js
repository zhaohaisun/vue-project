import{r as T,a as B,n as lt,g as ot,M as at,c as w,o as m,d as o,w as a,e as V,E as h,I as rt,J as Ve,b as p,G as I,H as z,h as U,l as D,f as y,C as x,N as st,i as E,p as he,K as nt,j as ke,k as it,L as dt,m as $e}from"./index-B3ZjBOUV.js";import{r as R,n as ut}from"./index-BE28LO_H.js";import{i as pt}from"./index-4tqhF2Sn.js";import{_ as mt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ct={class:"relationship-management"},gt={class:"card-header"},ft={class:"header-controls"},yt={class:"time-range-controls"},vt={class:"action-buttons"},bt={key:0,class:"temporal-properties-section"},wt={class:"temporal-controls"},_t={key:0,class:"time-hint"},Tt={class:"temporal-charts-container"},Vt={class:"temporal-charts"},ht=["id"],kt={key:0,class:"temporal-loading-placeholder"},$t={key:1,class:"temporal-empty-state"},It={class:"temporal-properties-list"},Ct={class:"temporal-properties-header"},Pt={class:"temporal-property-actions"},Rt={class:"node-info"},xt={class:"node-labels"},Ut={class:"node-info"},zt={class:"node-labels"},Dt={key:0},Lt={key:1,class:"no-data"},Nt={class:"pagination-container"},Ft={class:"relation-info"},Kt={class:"relation-node"},St={class:"relation-type"},qt={class:"relation-node"},Mt={class:"dialog-footer"},At={class:"dialog-footer"},Ht={class:"dialog-footer"},jt={class:"dialog-footer"},Ot={__name:"RelationshipManagement",setup(Bt){const re=T(!1),se=T(!1),q=T({}),F=T({}),Ie=(l,e,s)=>{const r=`${e}_${s}`;l?(q.value[r]=l,console.log(`设置图表引用 ${r}:`,l)):q.value[r]&&(console.log(`清理图表引用 ${r}`),delete q.value[r])},ne=T([]),K=T([]),ie=T([]),M=T(1),Y=T(50),ye=T(0),Z=B({type:""}),C=B({startTime:"",endTime:""}),Ce=lt(()=>{let l=ne.value;return Z.type&&(l=l.filter(e=>e.type===Z.type)),l}),A=T(!1),L=T(!1),W=T(null),H=T(null),_=B({sourceId:"",targetId:"",type:"",properties:[{key:"",value:""}]}),Q=T(!1),G=T(!1),J=T(!1),de=T(!1),ue=T(!1),pe=T(!1),v=B({relationshipId:"",propertyKey:"",time:"",value:""}),b=B({relationshipId:"",propertyKey:"",startTime:"",endTime:"",value:""}),n=B({relationshipId:"",propertyKey:"",createMode:"single",time:"",value:"",startTime:"",endTime:"",rangeValue:""}),me=T(null),ce=T(null),ge=T(null),Pe={sourceId:[{required:!0,message:"请选择起始节点",trigger:"change"}],targetId:[{required:!0,message:"请选择目标节点",trigger:"change"}],type:[{required:!0,message:"请输入关系类型",trigger:"change"}]},ee=l=>{const e=l.id,s=l.labels||[],r=l.properties||{};let i=`ID: ${e}`;if(s.length>0&&(i+=` [${s.join(", ")}]`),r.name)i+=` - ${r.name}`;else if(r.title)i+=` - ${r.title}`;else if(r.label)i+=` - ${r.label}`;else{const u=Object.keys(r);if(u.length>0){const d=u[0],c=r[d];c&&c.toString().length<50&&(i+=` - ${d}: ${c}`)}}return i},j=async()=>{re.value=!0;try{const l=await R.getRelationshipTypes();ie.value=l.data||[];const e=await R.getRelationshipsCount();ye.value=parseInt(e.data)||0;const r=(await R.getRelationshipsPaginated(M.value,Y.value)).data||[],i=[],u=new Set;for(const d of r){const c=d.start.split("/").pop(),k=d.end.split("/").pop(),g=d.self.split("/").pop();u.add(c),u.add(k),i.push({id:g,type:d.type,sourceId:c,targetId:k,sourceLabels:[],targetLabels:[],properties:d.data||{},self:d.self,temporalProperties:[],temporalLoading:!1,temporalCharts:[],hasQueried:!1})}if(i.length>0){await ve();for(const d of i){const c=K.value.find(g=>g.id===d.sourceId),k=K.value.find(g=>g.id===d.targetId);d.sourceLabels=(c==null?void 0:c.labels)||[],d.targetLabels=(k==null?void 0:k.labels)||[];try{const g=await R.getRelationshipTemporalProperties(d.id);d.temporalProperties=g.data||[]}catch(g){console.warn(`获取关系 ${d.id} 的时态属性失败:`,g),d.temporalProperties=[]}}}ne.value=i}catch(l){console.error("获取关系数据失败:",l),h.error("获取关系数据失败，请检查后端服务是否正常运行")}finally{re.value=!1}},ve=async()=>{if(!(K.value.length>0))try{const s=((await ut.getNodesPaginated(1,1e3)).data||[]).map(r=>{let i=r.id;return r.self&&(i=r.self.split("/").pop()),i=String(i),{id:i,labels:r.labels||[],properties:r.data||r.properties||{},self:r.self}});K.value=s,console.log("获取到节点数据:",s.length,"个节点")}catch(l){console.error("获取节点数据失败:",l),h.error("获取节点数据失败，请检查后端服务是否正常运行")}},Re=async l=>{Y.value=l,M.value=1,await j()},xe=async l=>{M.value=l,await j()},Ue=()=>{M.value=1},ze=async()=>{await ve(),L.value=!1,A.value=!0,H.value=null,Object.assign(_,{sourceId:"",targetId:"",type:"",properties:[{key:"",value:""}]}),W.value&&W.value.clearValidate()},De=l=>{L.value=!0,A.value=!0,H.value=l,_.properties=[];for(const[e,s]of Object.entries(l.properties))_.properties.push({key:e,value:s});_.properties.length===0&&_.properties.push({key:"",value:""})},Le=()=>{_.properties.push({key:"",value:""})},Ne=l=>{_.properties.splice(l,1)},Fe=async()=>{var l,e,s;if(W.value)try{await W.value.validate(),se.value=!0;const r={};_.properties.forEach(u=>{u.key&&u.value&&(r[u.key]=u.value)});let i=(l=H.value)==null?void 0:l.id;if(L.value)for(const[u,d]of Object.entries(r))await R.setRelationshipProperty(i,u,d);else{const u=String(_.sourceId),d=String(_.targetId);if(!u||u==="undefined"||u==="null")throw new Error("起始节点ID无效");if(!d||d==="undefined"||d==="null")throw new Error("目标节点ID无效");i=(await R.createRelationship(u,d,_.type,r)).data.self.split("/").pop()}if(L.value)h.success("关系更新成功");else{const u=K.value.find(g=>g.id===_.sourceId),d=K.value.find(g=>g.id===_.targetId),c=u?ee(u):`ID: ${_.sourceId}`,k=d?ee(d):`ID: ${_.targetId}`;h.success({message:`关系创建成功：${c} -[${_.type}]-> ${k}`,duration:4e3})}A.value=!1,j()}catch(r){console.error("保存关系失败:",r),h.error((L.value?"更新关系失败: ":"创建关系失败: ")+(((s=(e=r.response)==null?void 0:e.data)==null?void 0:s.message)||r.message||"未知错误"))}finally{se.value=!1}},Ke=l=>{$e.confirm("此操作将永久删除该关系，是否继续？","警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await R.deleteRelationship(l.id),h.success("删除成功"),j()}catch(e){console.error("删除关系失败:",e),h.error("删除关系失败")}}).catch(()=>{h.info("已取消删除")})};ot(()=>{j()}),at(()=>{Object.values(F.value).forEach(l=>{l&&typeof l.dispose=="function"&&(l._resizeHandler&&window.removeEventListener("resize",l._resizeHandler),l.dispose())}),F.value={}});const Se=l=>{console.log(`清理关系 ${l} 的图表实例`),Object.keys(F.value).forEach(e=>{if(e.startsWith(`${l}_`)){const s=F.value[e];s&&typeof s.dispose=="function"&&(console.log(`销毁图表实例: ${e}`),s._resizeHandler&&window.removeEventListener("resize",s._resizeHandler),s.dispose()),delete F.value[e],delete q.value[e]}})},te=async l=>{try{const e=ne.value.find(r=>r.id===l);if(!e){console.warn(`找不到关系 ID: ${l}`);return}const s=await R.getRelationshipTemporalProperties(l);e.temporalProperties=s.data||[],console.log(`更新关系 ${l} 的时态属性:`,e.temporalProperties)}catch(e){console.warn(`获取关系 ${l} 的时态属性失败:`,e)}},qe=async l=>{if(!C.startTime||!C.endTime){h.warning("请在页面右上角输入时间范围");return}console.log("开始查询时态数据，关系ID:",l.id),console.log("时间范围:",C.startTime,"到",C.endTime),console.log("时态属性列表:",l.temporalProperties);const e=document.documentElement.scrollTop||document.body.scrollTop;l.temporalLoading=!0,l.hasQueried=!0;try{const s=C.startTime,r=C.endTime,i=l.temporalProperties.map(async d=>{try{console.log(`查询时态属性: ${d}`);const c=await R.getRelationshipTemporalPropertyRange(l.id,d,s,r);console.log(`属性 ${d} 响应数据:`,c.data);const k=c.data||{},g=Object.entries(k).map(([$,N])=>{const O=le($);return console.log(`时间转换: ${$} -> ${O}`),{time:O,value:N,originalTime:$}}).sort(($,N)=>$.originalTime.localeCompare(N.originalTime));return console.log(`属性 ${d} 转换后的图表数据:`,g),{propertyName:d,data:g}}catch(c){return console.error(`查询时态属性 ${d} 失败:`,c),{propertyName:d,data:[]}}}),u=await Promise.all(i);console.log("所有图表数据:",u),Se(l.id),l.temporalCharts=u.filter(d=>d.data.length>0),console.log("过滤后的图表数据:",l.temporalCharts),await dt(),console.log("DOM更新完成，开始渲染图表"),requestAnimationFrame(()=>{Math.abs((document.documentElement.scrollTop||document.body.scrollTop)-e)>50&&window.scrollTo({top:e,behavior:"auto"})}),setTimeout(()=>{l.temporalCharts.forEach((d,c)=>{console.log(`渲染第 ${c+1} 个图表:`,d.propertyName),be(l.id,d)}),requestAnimationFrame(()=>{Math.abs((document.documentElement.scrollTop||document.body.scrollTop)-e)>50&&window.scrollTo({top:e,behavior:"auto"})})},100),l.temporalCharts.length===0?h.info("在指定时间范围内没有找到时态属性数据"):h.success(`成功生成 ${l.temporalCharts.length} 个时态属性图表`)}catch(s){console.error("查询时态数据失败:",s),h.error("查询时态数据失败: "+(s.message||"未知错误"))}finally{l.temporalLoading=!1}},le=l=>{if(l.length===7){const e=l.substring(0,1).padStart(2,"0"),s=l.substring(1,3),r=l.substring(3,5),i=l.substring(5,7);return`2010-${e}-${s} ${r}:${i}`}return l},be=(l,e)=>{const s=`${l}_${e.propertyName}`;console.log(`尝试渲染图表，key: ${s}`);const r=q.value[s];if(console.log("图表元素:",r),!r){console.warn(`找不到图表元素: ${s}`);let i=0;const u=8,d=()=>{setTimeout(()=>{i++;const c=q.value[s];console.log(`第 ${i} 次重试查找图表元素 ${s}:`,c),c&&c.offsetParent!==null?we(c,l,e):i<u?d():console.error(`经过 ${u} 次重试仍然找不到图表元素: ${s}`)},100+50*i)};d();return}if(r.offsetParent===null){console.warn(`图表元素 ${s} 不可见，延迟渲染`),setTimeout(()=>be(l,e),200);return}we(r,l,e)},we=(l,e,s)=>{const r=`${e}_${s.propertyName}`;F.value[r]&&(console.log(`销毁已存在的图表实例: ${r}`),F.value[r].dispose()),console.log(`创建新的图表实例: ${r}`),console.log("图表数据:",s),console.log("图表元素尺寸:",{width:l.offsetWidth,height:l.offsetHeight,clientWidth:l.clientWidth,clientHeight:l.clientHeight});try{(l.offsetWidth===0||l.offsetHeight===0)&&(console.warn("图表容器尺寸为0，强制设置尺寸"),l.style.width="100%",l.style.height="150px",l.style.minHeight="150px");const i=pt(l,null,{width:l.offsetWidth||800,height:l.offsetHeight||150});if(F.value[r]=i,!s.data||s.data.length===0){console.warn("图表数据为空");const g={xAxis:{type:"category",data:[]},yAxis:{type:"value"},series:[{name:s.propertyName,type:"line",step:"end",data:[]}],grid:{left:"10%",right:"10%",bottom:"20%",top:"10%",containLabel:!0}};i.setOption(g);return}const d=[...s.data].sort((g,$)=>{const N=le(g.time),O=le($.time);return new Date(N).getTime()-new Date(O).getTime()}).map(g=>{const $=le(g.time);return[new Date($).getTime(),g.value]});console.log("转换后的时间戳数据:",d);const c={tooltip:{trigger:"axis",formatter:function(g){if(g&&g.length>0){const $=g[0];return`时间: ${new Date($.value[0]).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}<br/>值: ${$.value[1]}`}return""}},xAxis:{type:"time",axisLabel:{formatter:function(g){return new Date(g).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})},rotate:45,fontSize:10,interval:"auto"},splitLine:{show:!0,lineStyle:{color:"#e0e0e0",width:1,type:"dashed"}}},yAxis:{type:"value",axisLabel:{fontSize:10}},series:[{name:s.propertyName,type:"line",step:"end",data:d,lineStyle:{width:2,color:"#409eff"},symbolSize:4,symbol:"circle"}],grid:{left:"10%",right:"10%",bottom:"20%",top:"10%",containLabel:!0},animation:!0,animationDuration:1e3};console.log("最终图表配置:",c),i.setOption(c,!0),setTimeout(()=>{i.resize()},100),console.log(`图表 ${r} 渲染完成`);const k=()=>{i&&!i.isDisposed()&&i.resize()};window.addEventListener("resize",k),i._resizeHandler=k}catch(i){console.error(`渲染图表 ${r} 时发生错误:`,i)}},Me=(l,e)=>{console.log("打开设置时态属性对话框:",l,e),v.relationshipId=l,v.propertyKey=e,v.time="",v.value="",Q.value=!0},Ae=(l,e)=>{console.log("打开设置时态属性范围对话框:",l,e),b.relationshipId=l,b.propertyKey=e,b.startTime="",b.endTime="",b.value="",G.value=!0},He=()=>{v.relationshipId="",v.propertyKey="",v.time="",v.value=""},je=()=>{b.relationshipId="",b.propertyKey="",b.startTime="",b.endTime="",b.value=""},Oe=async()=>{var l,e;if(console.log("提交设置时态属性:",v),!!me.value)try{await me.value.validate(),de.value=!0,console.log("调用API - setTemporalProperty:",{id:v.relationshipId,key:v.propertyKey,time:v.time,value:v.value}),await R.setTemporalProperty(v.relationshipId,v.propertyKey,v.time,v.value),h.success("时态属性设置成功"),Q.value=!1,await te(v.relationshipId)}catch(s){console.error("设置时态属性失败:",s),h.error("设置时态属性失败: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.message)||s.message))}finally{de.value=!1}},Be=async()=>{var l,e;if(ce.value)try{await ce.value.validate(),ue.value=!0,await R.setTemporalPropertyRange(b.relationshipId,b.propertyKey,b.startTime,b.endTime,b.value),h.success("时态属性范围设置成功"),G.value=!1,await te(b.relationshipId)}catch(s){console.error("设置时态属性范围失败:",s),h.error("设置时态属性范围失败: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.message)||s.message))}finally{ue.value=!1}},Ee=async(l,e)=>{var s,r;console.log("删除时态属性:",l,e);try{await $e.confirm(`确认删除关系 ${l} 的时态属性 "${e}" 吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),console.log("调用API - deleteTemporalProperty:",{id:l,key:e}),await R.deleteTemporalProperty(l,e),h.success("时态属性删除成功"),await te(l)}catch(i){if(i==="cancel"){console.log("用户取消删除操作");return}console.error("删除时态属性失败:",i),h.error("删除时态属性失败: "+(((r=(s=i.response)==null?void 0:s.data)==null?void 0:r.message)||i.message))}},We=l=>{console.log("打开新建时态属性对话框:",l),n.relationshipId=l,n.propertyKey="",n.createMode="single",n.time="",n.value="",n.startTime="",n.endTime="",n.rangeValue="",J.value=!0},Qe=()=>{n.relationshipId="",n.propertyKey="",n.createMode="single",n.time="",n.value="",n.startTime="",n.endTime="",n.rangeValue=""},Ge=async()=>{var l,e;if(console.log("提交新建时态属性:",n),!!ge.value)try{await ge.value.validate(),pe.value=!0,n.createMode==="single"?(console.log("调用API - setTemporalProperty (单个时间点):",{id:n.relationshipId,key:n.propertyKey,time:n.time,value:n.value}),await R.setTemporalProperty(n.relationshipId,n.propertyKey,n.time,n.value),h.success("单个时间点时态属性创建成功")):(console.log("调用API - setTemporalPropertyRange (时间范围):",{id:n.relationshipId,key:n.propertyKey,startTime:n.startTime,endTime:n.endTime,value:n.rangeValue}),await R.setTemporalPropertyRange(n.relationshipId,n.propertyKey,n.startTime,n.endTime,n.rangeValue),h.success("时间范围时态属性创建成功")),J.value=!1,await te(n.relationshipId)}catch(s){console.error("创建时态属性失败:",s),h.error("创建时态属性失败: "+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.message)||s.message))}finally{pe.value=!1}};return(l,e)=>{const s=V("el-input"),r=V("el-form-item"),i=V("el-form"),u=V("el-button"),d=V("el-tooltip"),c=V("el-option"),k=V("el-select"),g=V("el-descriptions-item"),$=V("el-descriptions"),N=V("el-divider"),O=V("el-skeleton"),Je=V("el-empty"),X=V("el-tag"),_e=V("el-card"),S=V("el-table-column"),Xe=V("el-table"),Ye=V("el-pagination"),fe=V("el-col"),Ze=V("el-row"),oe=V("el-dialog"),Te=V("el-radio"),et=V("el-radio-group"),tt=rt("loading");return m(),w("div",ct,[o(_e,{class:"relationship-card"},{header:a(()=>[p("div",gt,[e[35]||(e[35]=p("span",null,"关系管理",-1)),p("div",ft,[p("div",yt,[o(i,{inline:!0,class:"time-form"},{default:a(()=>[o(r,{label:"时间范围:"},{default:a(()=>[o(s,{modelValue:C.startTime,"onUpdate:modelValue":e[0]||(e[0]=t=>C.startTime=t),placeholder:"开始时间 (如: 05010005)",style:{width:"120px"},class:"time-input"},null,8,["modelValue"]),e[33]||(e[33]=p("span",{class:"time-separator"},"至",-1)),o(s,{modelValue:C.endTime,"onUpdate:modelValue":e[1]||(e[1]=t=>C.endTime=t),placeholder:"结束时间 (如: 05010540)",style:{width:"120px"},class:"time-input"},null,8,["modelValue"])]),_:1})]),_:1})]),p("div",vt,[o(d,{content:"刷新",placement:"top"},{default:a(()=>[o(u,{icon:E(it),circle:"",onClick:j},null,8,["icon"])]),_:1}),o(u,{type:"primary",onClick:ze},{default:a(()=>e[34]||(e[34]=[y("创建关系")])),_:1})])])])]),default:a(()=>[o(i,{inline:!0,class:"search-form"},{default:a(()=>[o(r,{label:"关系类型"},{default:a(()=>[o(k,{modelValue:Z.type,"onUpdate:modelValue":e[2]||(e[2]=t=>Z.type=t),clearable:"",placeholder:"选择关系类型",onChange:Ue},{default:a(()=>[(m(!0),w(I,null,z(ie.value,t=>(m(),U(c,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),Ve((m(),U(Xe,{data:Ce.value,border:"",style:{width:"100%"},height:"calc(100vh - 330px)","row-key":"id"},{default:a(()=>[o(S,{type:"expand"},{default:a(t=>[o(_e,{class:"relationship-properties"},{header:a(()=>e[36]||(e[36]=[p("div",{class:"card-header"},[p("span",null,"关系属性")],-1)])),default:a(()=>[o($,{border:""},{default:a(()=>[(m(!0),w(I,null,z(t.row.properties,(f,P)=>(m(),U(g,{key:P,label:P},{default:a(()=>[y(x(f),1)]),_:2},1032,["label"]))),128))]),_:2},1024),t.row.temporalProperties&&t.row.temporalProperties.length>0?(m(),w("div",bt,[o(N,{"content-position":"left"},{default:a(()=>e[37]||(e[37]=[y("时态属性")])),_:1}),p("div",wt,[o(u,{type:"primary",onClick:f=>qe(t.row),loading:t.row.temporalLoading,disabled:!C.startTime||!C.endTime},{default:a(()=>e[38]||(e[38]=[y(" 查询时态数据 ")])),_:2},1032,["onClick","loading","disabled"]),!C.startTime||!C.endTime?(m(),w("span",_t," 请在页面右上角输入时间范围 ")):D("",!0)]),p("div",Tt,[Ve(p("div",Vt,[(m(!0),w(I,null,z(t.row.temporalCharts,(f,P)=>(m(),w("div",{key:`chart-${t.row.id}-${f.propertyName}`,class:"chart-container"},[p("h4",null,x(f.propertyName)+" 时间变化图",1),p("div",{ref_for:!0,ref:ae=>Ie(ae,t.row.id,f.propertyName),class:"chart",style:{width:"100%",height:"150px"},id:`chart-${t.row.id}-${f.propertyName}`},null,8,ht)]))),128))],512),[[st,t.row.temporalCharts&&t.row.temporalCharts.length>0]]),t.row.temporalLoading?(m(),w("div",kt,[o(O,{rows:3,animated:""}),e[39]||(e[39]=p("div",{class:"loading-text"},"正在查询时态数据...",-1))])):D("",!0),!t.row.temporalLoading&&(!t.row.temporalCharts||t.row.temporalCharts.length===0)&&t.row.hasQueried?(m(),w("div",$t,[o(Je,{description:"暂无时态数据","image-size":60})])):D("",!0)]),p("div",It,[p("div",Ct,[e[41]||(e[41]=p("h4",null,"时态属性列表:",-1)),o(u,{size:"small",type:"success",onClick:f=>We(t.row.id),icon:E(he)},{default:a(()=>e[40]||(e[40]=[y(" 新建时态属性 ")])),_:2},1032,["onClick","icon"])]),(m(!0),w(I,null,z(t.row.temporalProperties,f=>(m(),w("div",{class:"temporal-property-item",key:f},[o(X,{type:"info",class:"temporal-property-tag"},{default:a(()=>[y(x(f),1)]),_:2},1024),p("div",Pt,[o(u,{size:"small",type:"primary",onClick:P=>Me(t.row.id,f)},{default:a(()=>e[42]||(e[42]=[y(" 设置值 ")])),_:2},1032,["onClick"]),o(u,{size:"small",type:"warning",onClick:P=>Ae(t.row.id,f)},{default:a(()=>e[43]||(e[43]=[y(" 设置范围 ")])),_:2},1032,["onClick"]),o(u,{size:"small",type:"danger",onClick:P=>Ee(t.row.id,f)},{default:a(()=>e[44]||(e[44]=[y(" 删除 ")])),_:2},1032,["onClick"])])]))),128))])])):D("",!0)]),_:2},1024)]),_:1}),o(S,{prop:"id",label:"ID",width:"80"}),o(S,{label:"关系类型",width:"150"},{default:a(t=>[o(X,{type:"success"},{default:a(()=>[y(x(t.row.type),1)]),_:2},1024)]),_:1}),o(S,{label:"起始节点","min-width":"180"},{default:a(t=>[p("div",Rt,[p("div",null,"ID: "+x(t.row.sourceId),1),p("div",xt,[(m(!0),w(I,null,z(t.row.sourceLabels,f=>(m(),U(X,{key:f,size:"small",class:"tag-item",effect:"plain"},{default:a(()=>[y(x(f),1)]),_:2},1024))),128))])])]),_:1}),o(S,{label:"目标节点","min-width":"180"},{default:a(t=>[p("div",Ut,[p("div",null,"ID: "+x(t.row.targetId),1),p("div",zt,[(m(!0),w(I,null,z(t.row.targetLabels,f=>(m(),U(X,{key:f,size:"small",class:"tag-item",effect:"plain"},{default:a(()=>[y(x(f),1)]),_:2},1024))),128))])])]),_:1}),o(S,{label:"属性","min-width":"180"},{default:a(t=>[Object.keys(t.row.properties).length>0?(m(),w("div",Dt,[(m(!0),w(I,null,z(t.row.properties,(f,P,ae)=>(m(),w("div",{key:P,class:"property-preview"},[ae<2?(m(),w(I,{key:0},[p("strong",null,x(P)+":",1),y(" "+x(f),1)],64)):ae===2?(m(),w(I,{key:1},[y(" ... ")],64)):D("",!0)]))),128))])):(m(),w("span",Lt,"无属性"))]),_:1}),o(S,{label:"操作",width:"200",fixed:"right"},{default:a(t=>[o(u,{type:"primary",size:"small",onClick:f=>De(t.row),icon:E(nt)},{default:a(()=>e[45]||(e[45]=[y(" 编辑 ")])),_:2},1032,["onClick","icon"]),o(u,{type:"danger",size:"small",onClick:f=>Ke(t.row),icon:E(ke)},{default:a(()=>e[46]||(e[46]=[y(" 删除 ")])),_:2},1032,["onClick","icon"])]),_:1})]),_:1},8,["data"])),[[tt,re.value]]),p("div",Nt,[o(Ye,{"current-page":M.value,"onUpdate:currentPage":e[3]||(e[3]=t=>M.value=t),"page-size":Y.value,"onUpdate:pageSize":e[4]||(e[4]=t=>Y.value=t),"page-sizes":[50,100,200],layout:"total, sizes, prev, pager, next, jumper",total:ye.value,onSizeChange:Re,onCurrentChange:xe},null,8,["current-page","page-size","total"])])]),_:1}),o(oe,{modelValue:A.value,"onUpdate:modelValue":e[9]||(e[9]=t=>A.value=t),title:L.value?"编辑关系":"创建关系",width:"800px","destroy-on-close":""},{footer:a(()=>[p("span",Mt,[o(u,{onClick:e[8]||(e[8]=t=>A.value=!1)},{default:a(()=>e[51]||(e[51]=[y("取消")])),_:1}),o(u,{type:"primary",onClick:Fe,loading:se.value},{default:a(()=>e[52]||(e[52]=[y(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>[o(i,{model:_,rules:Pe,ref_key:"relationFormRef",ref:W,"label-width":"100px"},{default:a(()=>[L.value?D("",!0):(m(),U(r,{key:0,label:"起始节点",prop:"sourceId"},{default:a(()=>[o(k,{modelValue:_.sourceId,"onUpdate:modelValue":e[5]||(e[5]=t=>_.sourceId=t),placeholder:"请选择起始节点",filterable:"",clearable:"",style:{width:"100%"}},{default:a(()=>[(m(!0),w(I,null,z(K.value,t=>(m(),U(c,{key:t.id,label:ee(t),value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),L.value?D("",!0):(m(),U(r,{key:1,label:"目标节点",prop:"targetId"},{default:a(()=>[o(k,{modelValue:_.targetId,"onUpdate:modelValue":e[6]||(e[6]=t=>_.targetId=t),placeholder:"请选择目标节点",filterable:"",clearable:"",style:{width:"100%"}},{default:a(()=>[(m(!0),w(I,null,z(K.value,t=>(m(),U(c,{key:t.id,label:ee(t),value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),L.value?D("",!0):(m(),U(r,{key:2,label:"关系类型",prop:"type"},{default:a(()=>[o(k,{modelValue:_.type,"onUpdate:modelValue":e[7]||(e[7]=t=>_.type=t),filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入关系类型"},{default:a(()=>[(m(!0),w(I,null,z(ie.value,t=>(m(),U(c,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})),L.value?(m(),U(r,{key:3,label:"关系信息"},{default:a(()=>[p("div",Ft,[p("div",Kt,[e[47]||(e[47]=p("div",{class:"node-label"},"起始节点",-1)),p("div",null,"ID: "+x(H.value.sourceId),1)]),p("div",St,[o(X,null,{default:a(()=>[y(x(H.value.type),1)]),_:1})]),p("div",qt,[e[48]||(e[48]=p("div",{class:"node-label"},"目标节点",-1)),p("div",null,"ID: "+x(H.value.targetId),1)])])]),_:1})):D("",!0),o(N,{"content-position":"left"},{default:a(()=>e[49]||(e[49]=[y("关系属性")])),_:1}),(m(!0),w(I,null,z(_.properties,(t,f)=>(m(),w("div",{key:f,class:"property-item"},[o(Ze,{gutter:10},{default:a(()=>[o(fe,{span:10},{default:a(()=>[o(r,{prop:"properties."+f+".key",rules:{required:!0,message:"请输入属性名",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:t.key,"onUpdate:modelValue":P=>t.key=P,placeholder:"属性名"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),o(fe,{span:10},{default:a(()=>[o(r,{prop:"properties."+f+".value",rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:t.value,"onUpdate:modelValue":P=>t.value=P,placeholder:"属性值"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop"])]),_:2},1024),o(fe,{span:4},{default:a(()=>[o(u,{type:"danger",icon:E(ke),circle:"",onClick:P=>Ne(f)},null,8,["icon","onClick"])]),_:2},1024)]),_:2},1024)]))),128)),o(r,null,{default:a(()=>[o(u,{type:"primary",icon:E(he),onClick:Le},{default:a(()=>e[50]||(e[50]=[y("添加属性")])),_:1},8,["icon"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),o(oe,{modelValue:Q.value,"onUpdate:modelValue":e[15]||(e[15]=t=>Q.value=t),title:"设置时态属性值",width:"500px",onClose:He},{footer:a(()=>[p("span",At,[o(u,{onClick:e[14]||(e[14]=t=>Q.value=!1)},{default:a(()=>e[54]||(e[54]=[y("取消")])),_:1}),o(u,{type:"primary",onClick:Oe,loading:de.value},{default:a(()=>e[55]||(e[55]=[y(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>[o(i,{ref_key:"temporalPropertyFormRef",ref:me,model:v,"label-width":"100px"},{default:a(()=>[o(r,{label:"关系ID"},{default:a(()=>[o(s,{modelValue:v.relationshipId,"onUpdate:modelValue":e[10]||(e[10]=t=>v.relationshipId=t),disabled:""},null,8,["modelValue"])]),_:1}),o(r,{label:"属性名"},{default:a(()=>[o(s,{modelValue:v.propertyKey,"onUpdate:modelValue":e[11]||(e[11]=t=>v.propertyKey=t),disabled:""},null,8,["modelValue"])]),_:1}),o(r,{label:"时间",prop:"time",rules:{required:!0,message:"请输入时间",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:v.time,"onUpdate:modelValue":e[12]||(e[12]=t=>v.time=t),placeholder:"请输入时间 (如: 5010105)"},null,8,["modelValue"]),e[53]||(e[53]=p("div",{class:"form-hint"},"时间格式：7位数字，如 5010105 表示 2010年05月01日 01:05",-1))]),_:1}),o(r,{label:"属性值",prop:"value",rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:v.value,"onUpdate:modelValue":e[13]||(e[13]=t=>v.value=t),placeholder:"请输入属性值"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(oe,{modelValue:G.value,"onUpdate:modelValue":e[22]||(e[22]=t=>G.value=t),title:"设置时态属性范围",width:"500px",onClose:je},{footer:a(()=>[p("span",Ht,[o(u,{onClick:e[21]||(e[21]=t=>G.value=!1)},{default:a(()=>e[57]||(e[57]=[y("取消")])),_:1}),o(u,{type:"primary",onClick:Be,loading:ue.value},{default:a(()=>e[58]||(e[58]=[y(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>[o(i,{ref_key:"temporalRangeFormRef",ref:ce,model:b,"label-width":"100px"},{default:a(()=>[o(r,{label:"关系ID"},{default:a(()=>[o(s,{modelValue:b.relationshipId,"onUpdate:modelValue":e[16]||(e[16]=t=>b.relationshipId=t),disabled:""},null,8,["modelValue"])]),_:1}),o(r,{label:"属性名"},{default:a(()=>[o(s,{modelValue:b.propertyKey,"onUpdate:modelValue":e[17]||(e[17]=t=>b.propertyKey=t),disabled:""},null,8,["modelValue"])]),_:1}),o(r,{label:"开始时间",prop:"startTime",rules:{required:!0,message:"请输入开始时间",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:b.startTime,"onUpdate:modelValue":e[18]||(e[18]=t=>b.startTime=t),placeholder:"请输入开始时间 (如: 5010010)"},null,8,["modelValue"])]),_:1}),o(r,{label:"结束时间",prop:"endTime",rules:{required:!0,message:"请输入结束时间",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:b.endTime,"onUpdate:modelValue":e[19]||(e[19]=t=>b.endTime=t),placeholder:"请输入结束时间 (如: 5010540)"},null,8,["modelValue"])]),_:1}),o(r,{label:"属性值",prop:"value",rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:b.value,"onUpdate:modelValue":e[20]||(e[20]=t=>b.value=t),placeholder:"请输入属性值"},null,8,["modelValue"])]),_:1}),e[56]||(e[56]=p("div",{class:"form-hint"},"时间格式：7位数字，如 5010010 表示 2010年05月01日 00:10",-1))]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(oe,{modelValue:J.value,"onUpdate:modelValue":e[32]||(e[32]=t=>J.value=t),title:"新建时态属性",width:"600px",onClose:Qe},{footer:a(()=>[p("span",jt,[o(u,{onClick:e[31]||(e[31]=t=>J.value=!1)},{default:a(()=>e[62]||(e[62]=[y("取消")])),_:1}),o(u,{type:"primary",onClick:Ge,loading:pe.value},{default:a(()=>e[63]||(e[63]=[y(" 确认 ")])),_:1},8,["loading"])])]),default:a(()=>[o(i,{ref_key:"createTemporalPropertyFormRef",ref:ge,model:n,"label-width":"100px"},{default:a(()=>[o(r,{label:"关系ID"},{default:a(()=>[o(s,{modelValue:n.relationshipId,"onUpdate:modelValue":e[23]||(e[23]=t=>n.relationshipId=t),disabled:""},null,8,["modelValue"])]),_:1}),o(r,{label:"属性名",prop:"propertyKey",rules:{required:!0,message:"请输入属性名",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:n.propertyKey,"onUpdate:modelValue":e[24]||(e[24]=t=>n.propertyKey=t),placeholder:"请输入时态属性名 (如: temp_travelTime)"},null,8,["modelValue"])]),_:1}),o(r,{label:"创建方式"},{default:a(()=>[o(et,{modelValue:n.createMode,"onUpdate:modelValue":e[25]||(e[25]=t=>n.createMode=t)},{default:a(()=>[o(Te,{value:"single"},{default:a(()=>e[59]||(e[59]=[y("单个时间点")])),_:1}),o(Te,{value:"range"},{default:a(()=>e[60]||(e[60]=[y("时间范围")])),_:1})]),_:1},8,["modelValue"])]),_:1}),n.createMode==="single"?(m(),w(I,{key:0},[o(r,{label:"时间",prop:"time",rules:{required:!0,message:"请输入时间",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:n.time,"onUpdate:modelValue":e[26]||(e[26]=t=>n.time=t),placeholder:"请输入时间 (如: 5010105)"},null,8,["modelValue"])]),_:1}),o(r,{label:"属性值",prop:"value",rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:n.value,"onUpdate:modelValue":e[27]||(e[27]=t=>n.value=t),placeholder:"请输入属性值"},null,8,["modelValue"])]),_:1})],64)):D("",!0),n.createMode==="range"?(m(),w(I,{key:1},[o(r,{label:"开始时间",prop:"startTime",rules:{required:!0,message:"请输入开始时间",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:n.startTime,"onUpdate:modelValue":e[28]||(e[28]=t=>n.startTime=t),placeholder:"请输入开始时间 (如: 05010115)"},null,8,["modelValue"])]),_:1}),o(r,{label:"结束时间",prop:"endTime",rules:{required:!0,message:"请输入结束时间",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:n.endTime,"onUpdate:modelValue":e[29]||(e[29]=t=>n.endTime=t),placeholder:"请输入结束时间 (如: 05010325)"},null,8,["modelValue"])]),_:1}),o(r,{label:"属性值",prop:"rangeValue",rules:{required:!0,message:"请输入属性值",trigger:"blur"}},{default:a(()=>[o(s,{modelValue:n.rangeValue,"onUpdate:modelValue":e[30]||(e[30]=t=>n.rangeValue=t),placeholder:"请输入属性值"},null,8,["modelValue"])]),_:1})],64)):D("",!0),e[61]||(e[61]=p("div",{class:"form-hint"},[p("p",null,"时间格式：7-8位数字"),p("p",null,"• 单个时间点：如 5010105 表示 2010年05月01日 01:05"),p("p",null,"• 时间范围：如 05010115 表示 2010年05月01日 01:15")],-1))]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Jt=mt(Ot,[["__scopeId","data-v-4a9a496f"]]);export{Jt as default};
